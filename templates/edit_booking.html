{% extends 'base.html' %}

{% block title %}Редактирование бронирования{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/edit_booking.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% endblock %}

{% block content %}
<div class="booking-form-container">
    <h1>Редактирование бронирования</h1>
    
    <form method="POST" action="{{ url_for('edit_booking', booking_id=booking.id_booking) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="form-group">
            <label for="room_type">Тип номера:</label>
            <select id="room_type" name="room_type" required>
                {% for room in rooms %}
                <option value="{{ room.room_type }}" 
                    {% if room.id_room == booking.room_id %}selected{% endif %}>
                    {{ room.name }} ({{ room.price_per_night }} ₽/ночь)
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="check_in">Дата заезда:</label>
            <input type="date" id="check_in" name="check_in" 
                   value="{{ check_in }}" required>
        </div>
        
        <div class="form-group">
            <label for="check_out">Дата выезда:</label>
            <input type="date" id="check_out" name="check_out" 
                   value="{{ check_out }}" required>
        </div>
        
        <div class="form-group">
            <label for="guests">Количество гостей:</label>
            <input type="number" id="guests" name="guests" 
                   min="1" max="4" value="{{ booking.guests_count }}" required>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="save-btn">Сохранить изменения</button>
            <a href="{{ url_for('account') }}" class="cancel-btn">Отмена</a>
            <button type="button" onclick="confirmDelete()" class="delete-btn">
                Удалить бронирование
            </button>
        </div>
    </form>
    
    <form id="delete-form" method="POST" 
          action="{{ url_for('delete_booking', booking_id=booking.id_booking) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
<script>
    // Инициализация календаря
    flatpickr("#check_in, #check_out", {
        locale: "ru",
        minDate: "today",
        dateFormat: "Y-m-d"
    });
    
    function confirmDelete() {
        if (confirm('Вы уверены, что хотите удалить это бронирование?')) {
            document.getElementById('delete-form').submit();
        }
    }
</script>
{% endblock %}